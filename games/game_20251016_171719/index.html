<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crystal Clicker - PixiJS Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/8.13.2/pixi.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a2e;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #gameContainer {
            text-align: center;
        }
        .error {
            color: white;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="loading" style="color: white;">Loading game...</div>
    </div>

    <script>
        console.log('Script started');
        
        // Wait for everything to load
        setTimeout(function() {
            try {
                console.log('Initializing game...');
                
                // Check if PIXI is available
                if (typeof PIXI === 'undefined') {
                    throw new Error('PixiJS not loaded');
                }
                
                console.log('PIXI version:', PIXI.VERSION);
                
                // Game state
                var score = 0;
                var clickPower = 1;
                var autoClickers = 0;
                var powerCost = 10;
                var autoCost = 50;
                
                // Create application
                var app;
                
                // Try different initialization methods for different PIXI versions
                if (PIXI.Application.prototype.init) {
                    // PixiJS v8 async init
                    app = new PIXI.Application();
                    app.init({
                        width: 800,
                        height: 600,
                        backgroundColor: 0x1a1a2e
                    }).then(function() {
                        setupGame();
                    }).catch(function(error) {
                        console.error('Init error:', error);
                        fallbackSetup();
                    });
                } else {
                    // Older PixiJS versions
                    app = new PIXI.Application({
                        width: 800,
                        height: 600,
                        backgroundColor: 0x1a1a2e
                    });
                    setTimeout(setupGame, 100);
                }
                
                function setupGame() {
                    try {
                        console.log('Setting up game...');
                        
                        // Remove loading message
                        var loading = document.getElementById('loading');
                        if (loading) loading.style.display = 'none';
                        
                        // Add canvas to page - try both .canvas and .view
                        var canvas = app.canvas || app.view;
                        if (!canvas) {
                            throw new Error('Could not get canvas from PIXI app');
                        }
                        
                        document.getElementById('gameContainer').appendChild(canvas);
                        console.log('Canvas added to page');
                        
                        // Create game elements
                        var gameStage = new PIXI.Container();
                        app.stage.addChild(gameStage);
                        
                        // Title
                        var title = new PIXI.Text('Crystal Clicker', {
                            fontFamily: 'Arial',
                            fontSize: 36,
                            fill: '#ff6b6b',
                            fontWeight: 'bold'
                        });
                        title.anchor.set(0.5);
                        title.x = 400;
                        title.y = 60;
                        gameStage.addChild(title);
                        
                        // Score display
                        var scoreText = new PIXI.Text('Score: 0', {
                            fontFamily: 'Arial',
                            fontSize: 24,
                            fill: '#ffffff'
                        });
                        scoreText.anchor.set(0.5);
                        scoreText.x = 400;
                        scoreText.y = 100;
                        gameStage.addChild(scoreText);
                        
                        // Click power display
                        var powerText = new PIXI.Text('Click Power: 1', {
                            fontFamily: 'Arial',
                            fontSize: 18,
                            fill: '#ffff00'
                        });
                        powerText.anchor.set(0.5);
                        powerText.x = 400;
                        powerText.y = 130;
                        gameStage.addChild(powerText);
                        
                        // Main click button
                        var clickButton = new PIXI.Graphics();
                        clickButton.beginFill(0x4ecdc4);
                        clickButton.drawCircle(0, 0, 50);
                        clickButton.endFill();
                        clickButton.x = 400;
                        clickButton.y = 250;
                        clickButton.interactive = true;
                        clickButton.buttonMode = true;
                        gameStage.addChild(clickButton);
                        
                        // Click handler
                        clickButton.on('pointerdown', handleClick);
                        clickButton.on('click', handleClick); // Fallback for older versions
                        
                        function handleClick() {
                            score += clickPower;
                            scoreText.text = 'Score: ' + score.toLocaleString();
                            
                            // Simple animation
                            clickButton.scale.set(0.9);
                            setTimeout(function() {
                                clickButton.scale.set(1);
                            }, 100);
                            
                            console.log('Score:', score);
                        }
                        
                        // Hover effects
                        clickButton.on('pointerover', function() {
                            clickButton.scale.set(1.1);
                        });
                        clickButton.on('pointerout', function() {
                            clickButton.scale.set(1);
                        });
                        
                        // Power upgrade button
                        var powerButton = new PIXI.Container();
                        var powerBg = new PIXI.Graphics();
                        powerBg.beginFill(0x333333);
                        powerBg.drawRoundedRect(-60, -20, 120, 40, 5);
                        powerBg.endFill();
                        powerButton.addChild(powerBg);
                        
                        var powerLabel = new PIXI.Text('Upgrade Power', {
                            fontFamily: 'Arial',
                            fontSize: 12,
                            fill: '#ffffff'
                        });
                        powerLabel.anchor.set(0.5);
                        powerLabel.y = -5;
                        powerButton.addChild(powerLabel);
                        
                        var powerCostText = new PIXI.Text('Cost: 10', {
                            fontFamily: 'Arial',
                            fontSize: 10,
                            fill: '#ffd700'
                        });
                        powerCostText.anchor.set(0.5);
                        powerCostText.y = 8;
                        powerButton.addChild(powerCostText);
                        
                        powerButton.x = 300;
                        powerButton.y = 400;
                        powerButton.interactive = true;
                        powerButton.buttonMode = true;
                        gameStage.addChild(powerButton);
                        
                        powerButton.on('pointerdown', function() {
                            if (score >= powerCost) {
                                score -= powerCost;
                                clickPower++;
                                powerCost *= 2;
                                
                                scoreText.text = 'Score: ' + score.toLocaleString();
                                powerText.text = 'Click Power: ' + clickPower;
                                powerCostText.text = 'Cost: ' + powerCost.toLocaleString();
                                
                                console.log('Power upgraded to:', clickPower);
                            }
                        });
                        
                        // Auto clicker button
                        var autoButton = new PIXI.Container();
                        var autoBg = new PIXI.Graphics();
                        autoBg.beginFill(0x333333);
                        autoBg.drawRoundedRect(-60, -20, 120, 40, 5);
                        autoBg.endFill();
                        autoButton.addChild(autoBg);
                        
                        var autoLabel = new PIXI.Text('Auto Clicker', {
                            fontFamily: 'Arial',
                            fontSize: 12,
                            fill: '#ffffff'
                        });
                        autoLabel.anchor.set(0.5);
                        autoLabel.y = -5;
                        autoButton.addChild(autoLabel);
                        
                        var autoCostText = new PIXI.Text('Cost: 50', {
                            fontFamily: 'Arial',
                            fontSize: 10,
                            fill: '#ffd700'
                        });
                        autoCostText.anchor.set(0.5);
                        autoCostText.y = 8;
                        autoButton.addChild(autoCostText);
                        
                        autoButton.x = 500;
                        autoButton.y = 400;
                        autoButton.interactive = true;
                        autoButton.buttonMode = true;
                        gameStage.addChild(autoButton);
                        
                        autoButton.on('pointerdown', function() {
                            if (score >= autoCost) {
                                score -= autoCost;
                                autoClickers++;
                                autoCost = Math.floor(autoCost * 1.5);
                                
                                scoreText.text = 'Score: ' + score.toLocaleString();
                                autoCostText.text = 'Cost: ' + autoCost.toLocaleString();
                                autoText.text = 'Auto Clickers: ' + autoClickers;
                                
                                console.log('Auto clickers:', autoClickers);
                            }
                        });
                        
                        // Auto clicker display
                        var autoText = new PIXI.Text('Auto Clickers: 0', {
                            fontFamily: 'Arial',
                            fontSize: 16,
                            fill: '#00ff00'
                        });
                        autoText.anchor.set(0.5);
                        autoText.x = 400;
                        autoText.y = 450;
                        gameStage.addChild(autoText);
                        
                        // Auto clicker timer
                        setInterval(function() {
                            if (autoClickers > 0) {
                                score += autoClickers;
                                scoreText.text = 'Score: ' + score.toLocaleString();
                            }
                        }, 1000);
                        
                        // Simple rotation animation
                        if (app.ticker) {
                            app.ticker.add(function() {
                                clickButton.rotation += 0.01;
                            });
                        }
                        
                        console.log('Game setup complete!');
                        
                    } catch (error) {
                        console.error('Setup error:', error);
                        fallbackSetup();
                    }
                }
                
                function fallbackSetup() {
                    console.log('Using fallback setup');
                    document.getElementById('gameContainer').innerHTML = 
                        '<div class="error">' +
                        '<h2>Simple Clicker Game</h2>' +
                        '<p>Score: <span id="score">0</span></p>' +
                        '<button id="clickBtn" style="font-size: 20px; padding: 20px 40px; margin: 20px;">CLICK ME!</button>' +
                        '<br><button id="upgradeBtn" style="margin: 10px;">Upgrade Power (Cost: 10)</button>' +
                        '<p>This is a fallback HTML version since PixiJS had issues loading.</p>' +
                        '</div>';
                    
                    var score = 0;
                    var power = 1;
                    var cost = 10;
                    
                    document.getElementById('clickBtn').onclick = function() {
                        score += power;
                        document.getElementById('score').textContent = score;
                    };
                    
                    document.getElementById('upgradeBtn').onclick = function() {
                        if (score >= cost) {
                            score -= cost;
                            power++;
                            cost *= 2;
                            document.getElementById('score').textContent = score;
                            this.textContent = 'Upgrade Power (Cost: ' + cost + ')';
                        }
                    };
                }
                
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('gameContainer').innerHTML = 
                    '<div class="error">Failed to initialize game: ' + error.message + '</div>';
            }
        }, 1000);
    </script>
</body>
</html>